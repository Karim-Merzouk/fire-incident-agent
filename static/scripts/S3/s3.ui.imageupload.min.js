/*
 jQuery Color Animations v2.0pre
 http://jquery.org/

 Copyright 2011 John Resig
 Dual licensed under the MIT or GPL Version 2 licenses.
 http://jquery.org/license
*/
(function(f,S){function K(a,r,k){var h=aa[r.type]||{};if((r.empty||k)&&null==a)return null;if(r.def&&null==a)return r.def;a=h.floor?~~a:parseFloat(a);return null==a||isNaN(a)?r.def:h.mod?(a%=h.mod,0>a?h.mod+a:a):h.min>a?h.min:h.max<a?h.max:a}function F(a){var r=l(),k=r._rgba=[];a=a.toLowerCase();N(t,function(h,C){h=(h=C.re.exec(a))&&C.parse(h);var E=C.space||"rgba";C=A[E].cache;if(h)return h=r[E](h),r[C]=h[C],k=r._rgba=h._rgba,!1});if(0!==k.length)return 0===Math.max.apply(Math,k)&&f.extend(k,ca.transparent),
r;if(a=ca[a])return a}function e(a,r,k){k=(k+1)%1;return 1>6*k?a+6*(r-a)*k:1>2*k?r:2>3*k?a+(r-a)*(2/3-k)*6:a}var c=/^([\-+])=\s*(\d+\.?\d*)/,t=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(a){return[a[1],a[2],a[3],a[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)%\s*,\s*(\d+(?:\.\d+)?)%\s*,\s*(\d+(?:\.\d+)?)%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(a){return[2.55*a[1],2.55*a[2],2.55*a[3],a[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,
parse:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,parse:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)%\s*,\s*(\d+(?:\.\d+)?)%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(a){return[a[1],a[2]/100,a[3]/100,a[4]]}}],l=f.Color=function(a,r,k,h){return new f.Color.fn.parse(a,r,k,h)},A={rgba:{cache:"_rgba",props:{red:{idx:0,
type:"byte",empty:!0},green:{idx:1,type:"byte",empty:!0},blue:{idx:2,type:"byte",empty:!0},alpha:{idx:3,type:"percent",def:1}}},hsla:{cache:"_hsla",props:{hue:{idx:0,type:"degrees",empty:!0},saturation:{idx:1,type:"percent",empty:!0},lightness:{idx:2,type:"percent",empty:!0}}}},aa={"byte":{floor:!0,min:0,max:255},percent:{min:0,max:1},degrees:{mod:360,floor:!0}},T=A.rgba.props,Q=l.support={},N=f.each;A.hsla.props.alpha=T.alpha;l.fn=l.prototype={constructor:l,parse:function(a,r,k,h){if(a===S)return this._rgba=
[null,null,null,null],this;if(a instanceof f||a.nodeType)a=a instanceof f?a.css(r):f(a).css(r),r=S;var C=this,E=f.type(a),I=this._rgba=[];r!==S&&(a=[a,r,k,h],E="array");if("string"===E)return this.parse(F(a)||ca._default);if("array"===E)return N(T,function(O,z){I[z.idx]=K(a[z.idx],z)}),this;if("object"===E)return a instanceof l?N(A,function(O,z){a[z.cache]&&(C[z.cache]=a[z.cache].slice())}):N(A,function(O,z){N(z.props,function(G,b){var U=z.cache;if(!C[U]&&z.to){if(null==a[G]||"alpha"===G)return;C[U]=
z.to(C._rgba)}C[U][b.idx]=K(a[G],b,!0)})}),this},is:function(a){var r=l(a),k=!0,h=this;N(A,function(C,E){var I=r[E.cache];if(I){var O=h[E.cache]||E.to&&E.to(h._rgba)||[];N(E.props,function(z,G){if(null!=I[G.idx])return k=I[G.idx]===O[G.idx]})}return k});return k},_space:function(){var a=[],r=this;N(A,function(k,h){r[h.cache]&&a.push(k)});return a.pop()},transition:function(a,r){var k=l(a);a=k._space();var h=A[a],C=this[h.cache]||h.to(this._rgba),E=C.slice();k=k[h.cache];N(h.props,function(I,O){I=
O.idx;var z=C[I],G=k[I],b=aa[O.type]||{};null!==G&&(null===z?E[I]=G:(b.mod&&(G-z>b.mod/2?z+=b.mod:z-G>b.mod/2&&(z-=b.mod)),E[O.idx]=K((G-z)*r+z,O)))});return this[a](E)},blend:function(a){if(1===this._rgba[3])return this;var r=this._rgba.slice(),k=r.pop(),h=l(a)._rgba;return l(f.map(r,function(C,E){return(1-k)*h[E]+k*C}))},toRgbaString:function(){var a="rgba(",r=f.map(this._rgba,function(k,h){return null==k?2<h?1:0:k});1===r[3]&&(r.pop(),a="rgb(");return a+r.join(",")+")"},toHslaString:function(){var a=
"hsla(",r=f.map(this.hsla(),function(k,h){null==k&&(k=2<h?1:0);h&&3>h&&(k=Math.round(100*k)+"%");return k});1===r[3]&&(r.pop(),a="hsl(");return a+r.join(",")+")"},toHexString:function(a){var r=this._rgba.slice(),k=r.pop();a&&r.push(~~(255*k));return"#"+f.map(r,function(h,C){h=(h||0).toString(16);return 1===h.length?"0"+h:h}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}};l.fn.parse.prototype=l.fn;A.hsla.to=function(a){if(null==a[0]||null==a[1]||null==a[2])return[null,
null,null,a[3]];var r=a[0]/255,k=a[1]/255,h=a[2]/255;a=a[3];var C=Math.max(r,k,h),E=Math.min(r,k,h),I=C-E,O=C+E,z=.5*O;return[Math.round(E===C?0:r===C?60*(k-h)/I+360:k===C?60*(h-r)/I+120:60*(r-k)/I+240)%360,0===z||1===z?z:.5>=z?I/O:I/(2-O),z,null==a?1:a]};A.hsla.from=function(a){if(null==a[0]||null==a[1]||null==a[2])return[null,null,null,a[3]];var r=a[0]/360,k=a[1],h=a[2];a=a[3];k=.5>=h?h*(1+k):h+k-h*k;h=2*h-k;return[Math.round(255*e(h,k,r+1/3)),Math.round(255*e(h,k,r)),Math.round(255*e(h,k,r-1/3)),
a]};N(A,function(a,r){var k=r.props,h=r.cache,C=r.to,E=r.from;l.fn[a]=function(I){C&&!this[h]&&(this[h]=C(this._rgba));if(I===S)return this[h].slice();var O=f.type(I),z="array"===O||"object"===O?I:arguments,G=this[h].slice();N(k,function(U,ea){U=z["object"===O?U:ea.idx];null==U&&(U=G[ea.idx]);G[ea.idx]=K(U,ea)});if(E){var b=l(E(G));b[h]=G;return b}return l(G)};N(k,function(I,O){l.fn[I]||(l.fn[I]=function(z){var G=f.type(z),b="alpha"===I?this._hsla?"hsla":"rgba":a,U=this[b](),ea=U[O.idx];if("undefined"===
G)return ea;"function"===G&&(z=z.call(this,ea),G=f.type(z));if(null==z&&O.empty)return this;"string"===G&&(G=c.exec(z))&&(z=ea+parseFloat(G[2])*("+"===G[1]?1:-1));U[O.idx]=z;return this[b](U)})})});N("backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color outlineColor".split(" "),function(a,r){f.cssHooks[r]={set:function(k,h){var C;if("string"!==f.type(h)||(C=F(h))){h=l(C||h);if(!Q.rgba&&1!==h._rgba[3]){var E="backgroundColor"===r?k.parentNode:k;do C=f.curCSS(E,"backgroundColor");
while((""===C||"transparent"===C)&&(E=E.parentNode)&&E.style);h=h.blend(C&&"transparent"!==C?C:"_default")}h=h.toRgbaString()}k.style[r]=h}};f.fx.step[r]=function(k){k.colorInit||(k.start=l(k.elem,r),k.end=l(k.end),k.colorInit=!0);f.cssHooks[r].set(k.elem,k.start.transition(k.end,k.pos))}});f(function(){var a=document.createElement("div").style;a.cssText="background-color:rgba(1,1,1,.5)";Q.rgba=-1<a.backgroundColor.indexOf("rgba")});var ca=f.Color.names={aqua:"#00ffff",azure:"#f0ffff",beige:"#f5f5dc",
black:"#000000",blue:"#0000ff",brown:"#a52a2a",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkviolet:"#9400d3",fuchsia:"#ff00ff",gold:"#ffd700",green:"#008000",indigo:"#4b0082",khaki:"#f0e68c",lightblue:"#add8e6",lightcyan:"#e0ffff",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightyellow:"#ffffe0",
lime:"#00ff00",magenta:"#ff00ff",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#ffa500",pink:"#ffc0cb",purple:"#800080",violet:"#800080",red:"#ff0000",silver:"#c0c0c0",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}})(jQuery);
(function(f){f.Jcrop=function(S,K){function F(d){return Math.round(d)+"px"}function e(d){d=f(d).offset();return[d.left,d.top]}function c(d){return[d.pageX-oa[0],d.pageY-oa[1]]}function t(d){"object"!==typeof d&&(d={});b=f.extend(b,d);f.each(["onChange","onSelect","onRelease","onDblClick"],function(w,u){"function"!==typeof b[u]&&(b[u]=function(){})})}function l(d,w,u){oa=e(J);ia.setCursor("move"===d?d:d+"-resize");if("move"===d)return ia.activateHandlers(aa(w),a,u);w=L.getFixed();var B=T(d),m=L.getCorner(T(B));
L.setPressed(L.getCorner(B));L.setCurrent(m);ia.activateHandlers(A(d,w),a,u)}function A(d,w){return function(u){if(b.aspectRatio)switch(d){case "e":u[1]=w.y+1;break;case "w":u[1]=w.y+1;break;case "n":u[0]=w.x+1;break;case "s":u[0]=w.x+1}else switch(d){case "e":u[1]=w.y2;break;case "w":u[1]=w.y2;break;case "n":u[0]=w.x2;break;case "s":u[0]=w.x2}L.setCurrent(u);D.update()}}function aa(d){var w=d;za.watchKeys();return function(u){L.moveOffset([u[0]-w[0],u[1]-w[1]]);w=u;D.update()}}function T(d){switch(d){case "n":return"sw";
case "s":return"nw";case "e":return"nw";case "w":return"ne";case "ne":return"sw";case "nw":return"se";case "se":return"nw";case "sw":return"ne"}}function Q(d){return function(w){if(b.disabled||"move"===d&&!b.allowMove)return!1;oa=e(J);pa=!0;l(d,c(w));w.stopPropagation();w.preventDefault();return!1}}function N(d,w,u){var B=d.width(),m=d.height();B>w&&0<w&&(B=w,m=w/d.width()*d.height());m>u&&0<u&&(m=u,B=u/d.height()*d.width());Y=d.width()/B;ba=d.height()/m;d.width(B).height(m)}function ca(d){return{x:d.x*
Y,y:d.y*ba,x2:d.x2*Y,y2:d.y2*ba,w:d.w*Y,h:d.h*ba}}function a(d){d=L.getFixed();d.w>b.minSelect[0]&&d.h>b.minSelect[1]?(D.enableHandles(),D.done()):D.release();ia.setCursor(b.allowSelect?"crosshair":"default")}function r(d){if(b.disabled||!b.allowSelect)return!1;pa=!0;oa=e(J);D.disableHandles();ia.setCursor("crosshair");var w=c(d);L.setPressed(w);D.update();ia.activateHandlers(k,a,"touch"===d.type.substring(0,5));za.watchKeys();d.stopPropagation();d.preventDefault();return!1}function k(d){L.setCurrent(d);
D.update()}function h(){var d=f("<div></div>").addClass(b.baseClass+"-tracker");ea&&d.css({opacity:0,backgroundColor:"white"});return d}function C(d){E([d[0]/Y,d[1]/ba,d[2]/Y,d[3]/ba]);b.onSelect.call(fa,ca(L.getFixed()));D.enableHandles()}function E(d){L.setPressed([d[0],d[1]]);L.setCurrent([d[2],d[3]]);D.update()}function I(){b.disabled=!0;D.disableHandles();D.setCursor("default");ia.setCursor("default")}function O(){b.disabled=!1;G()}function z(d,w,u){w=w||b.bgColor;b.bgFade&&f.fx.step.hasOwnProperty("backgroundColor")&&
b.fadeTime&&!u?d.animate({backgroundColor:w},{queue:!1,duration:b.fadeTime}):d.css("backgroundColor",w)}function G(d){b.allowResize?d?D.enableOnly():D.enableHandles():D.disableHandles();ia.setCursor(b.allowSelect?"crosshair":"default");D.setCursor(b.allowMove?"move":"default");b.hasOwnProperty("trueSize")&&(Y=b.trueSize[0]/M,ba=b.trueSize[1]/H);b.hasOwnProperty("setSelect")&&(C(b.setSelect),D.done(),delete b.setSelect);la.refresh();b.bgColor!=Ca&&(z(b.shade?la.getShades():ja,b.shade?b.shadeColor||
b.bgColor:b.bgColor),Ca=b.bgColor);ta!=b.bgOpacity&&(ta=b.bgOpacity,b.shade?la.refresh():D.setBgOpacity(ta));ua=b.maxSize[0]||0;va=b.maxSize[1]||0;wa=b.minSize[0]||0;xa=b.minSize[1]||0;b.hasOwnProperty("outerImage")&&(J.attr("src",b.outerImage),delete b.outerImage);D.refresh()}var b=f.extend({},f.Jcrop.defaults),U=navigator.userAgent.toLowerCase(),ea=/msie/.test(U),Da=/msie [1-6]\./.test(U);"object"!==typeof S&&(S=f(S)[0]);"object"!==typeof K&&(K={});t(K);K={border:"none",visibility:"visible",margin:0,
padding:0,position:"absolute",top:0,left:0};var V=f(S);U=!0;if("IMG"==S.tagName){if(0!=V[0].width&&0!=V[0].height)V.width(V[0].width),V.height(V[0].height);else{var Aa=new Image;Aa.src=V[0].src;V.width(Aa.width);V.height(Aa.height)}var J=V.clone().removeAttr("id").css(K).show();J.width(V.width());J.height(V.height());V.after(J).hide()}else J=V.css(K).show(),U=!1,null===b.shade&&(b.shade=!0);N(J,b.boxWidth,b.boxHeight);var M=J.width(),H=J.height(),ja=f("<div />").width(M).height(H).addClass(b.baseClass+
"-holder").css({position:"relative",backgroundColor:b.bgColor}).insertAfter(V).append(J);b.addClass&&ja.addClass(b.addClass);var ma=f("<div />"),ya=f("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),qa=f("<div />").width("100%").height("100%").css("zIndex",320),ra=f("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var d=L.getFixed();b.onDblClick.call(fa,d)}).insertBefore(J).append(ya,qa);U&&(ma=f("<img />").attr("src",J.attr("src")).css(K).width(M).height(H),
ya.append(ma));Da&&ra.css({overflowY:"hidden"});var sa=b.boundary,na=h().width(M+2*sa).height(H+2*sa).css({position:"absolute",top:F(-sa),left:F(-sa),zIndex:290}).mousedown(r),Ca=b.bgColor,ta=b.bgOpacity,ua,va,wa,xa,Y,ba,pa,Ba,Ea;var oa=e(J);var ha=function(){function d(){var u={},B=["touchstart","touchmove","touchend"],m=document.createElement("div"),p;try{for(p=0;p<B.length;p++){var y=B[p];y="on"+y;var v=y in m;v||(m.setAttribute(y,"return;"),v="function"==typeof m[y]);u[B[p]]=v}return u.touchstart&&
u.touchend&&u.touchmove}catch(Z){return!1}}var w=!0===b.touchSupport||!1===b.touchSupport?b.touchSupport:d();return{createDragger:function(u){return function(B){if(b.disabled||"move"===u&&!b.allowMove)return!1;oa=e(J);pa=!0;l(u,c(ha.cfilter(B)),!0);B.stopPropagation();B.preventDefault();return!1}},newSelection:function(u){return r(ha.cfilter(u))},cfilter:function(u){u.pageX=u.originalEvent.changedTouches[0].pageX;u.pageY=u.originalEvent.changedTouches[0].pageY;return u},isSupported:d,support:w}}(),
L=function(){function d(){if(!b.aspectRatio){var g=y-m,x=v-p;ua&&Math.abs(g)>ua&&(y=0<g?m+ua:m-ua);va&&Math.abs(x)>va&&(v=0<x?p+va:p-va);xa/ba&&Math.abs(x)<xa/ba&&(v=0<x?p+xa/ba:p-xa/ba);wa/Y&&Math.abs(g)<wa/Y&&(y=0<g?m+wa/Y:m-wa/Y);0>m&&(y-=m,m-=m);0>p&&(v-=p,p-=p);0>y&&(m-=y,y-=y);0>v&&(p-=v,v-=v);y>M&&(g=y-M,m-=g,y-=g);v>H&&(g=v-H,p-=g,v-=g);m>M&&(g=m-H,v-=g,p-=g);p>H&&(g=p-H,v-=g,p-=g);return B(u(m,p,y,v))}g=b.aspectRatio;x=b.minSize[0]/Y;var R=b.maxSize[0]/Y,P=y-m,da=v-p,q=Math.abs(P),n=Math.abs(da);
0===R&&(R=10*M);q/n<g?(q=v,n*=g,n=0>P?m-n:n+m,0>n?(n=0,q=Math.abs((n-m)/g),q=0>da?p-q:q+p):n>M&&(n=M,q=Math.abs((n-m)/g),q=0>da?p-q:q+p)):(n=y,q/=g,q=0>da?p-q:p+q,0>q?(q=0,n=Math.abs((q-p)*g),n=0>P?m-n:n+m):q>H&&(q=H,n=Math.abs(q-p)*g,n=0>P?m-n:n+m));n>m?(n-m<x?n=m+x:n-m>R&&(n=m+R),q=q>p?p+(n-m)/g:p-(n-m)/g):n<m&&(m-n<x?n=m-x:m-n>R&&(n=m-R),q=q>p?p+(m-n)/g:p-(m-n)/g);0>n?(m-=n,n=0):n>M&&(m-=n-M,n=M);0>q?(p-=q,q=0):q>H&&(p-=q-H,q=H);return B(u(m,p,n,q))}function w(g){0>g[0]&&(g[0]=0);0>g[1]&&(g[1]=
0);g[0]>M&&(g[0]=M);g[1]>H&&(g[1]=H);return[Math.round(g[0]),Math.round(g[1])]}function u(g,x,R,P){var da=g,q=R,n=x,W=P;R<g&&(da=R,q=g);P<x&&(n=P,W=x);return[da,n,q,W]}function B(g){return{x:g[0],y:g[1],x2:g[2],y2:g[3],w:g[2]-g[0],h:g[3]-g[1]}}var m=0,p=0,y=0,v=0,Z,X;return{flipCoords:u,setPressed:function(g){g=w(g);y=m=g[0];v=p=g[1]},setCurrent:function(g){g=w(g);Z=g[0]-y;X=g[1]-v;y=g[0];v=g[1]},getOffset:function(){return[Z,X]},moveOffset:function(g){var x=g[0];g=g[1];0>m+x&&(x-=x+m);0>p+g&&(g-=
g+p);H<v+g&&(g+=H-(v+g));M<y+x&&(x+=M-(y+x));m+=x;y+=x;p+=g;v+=g},getCorner:function(g){var x=d();switch(g){case "ne":return[x.x2,x.y];case "nw":return[x.x,x.y];case "se":return[x.x2,x.y2];case "sw":return[x.x,x.y2]}},getFixed:d}}(),la=function(){function d(){return w(L.getFixed())}function w(x){g.top.css({left:F(x.x),width:F(x.w),height:F(x.y)});g.bottom.css({top:F(x.y2),left:F(x.x),width:F(x.w),height:F(H-x.y2)});g.right.css({left:F(x.x2),width:F(M-x.x2)});g.left.css({width:F(x.x)})}function u(){return f("<div />").css({position:"absolute",
backgroundColor:b.shadeColor||b.bgColor}).appendTo(X)}function B(){Z||(Z=!0,X.insertBefore(J),d(),D.setBgOpacity(1,0,1),ma.hide(),m(b.shadeColor||b.bgColor,1),D.isAwake()?y(b.bgOpacity,1):y(1,1))}function m(x,R){z(v(),x,R)}function p(){Z&&(X.remove(),ma.show(),Z=!1,D.isAwake()?D.setBgOpacity(b.bgOpacity,1,1):(D.setBgOpacity(1,1,1),D.disableHandles()),z(ja,0,1))}function y(x,R){Z&&(b.bgFade&&!R?X.animate({opacity:1-x},{queue:!1,duration:b.fadeTime}):X.css({opacity:1-x}))}function v(){return X.children()}
var Z=!1,X=f("<div />").css({position:"absolute",zIndex:240,opacity:0}),g={top:u(),left:u().height(H),right:u().height(H),bottom:u()};return{update:d,updateRaw:w,getShades:v,setBgColor:m,enable:B,disable:p,resize:function(x,R){g.left.css({height:F(R)});g.right.css({height:F(R)})},refresh:function(){b.shade?B():p();D.isAwake()&&y(b.bgOpacity)},opacity:y}}(),D=function(){function d(q,n){n=f("<div />").mousedown(Q(q)).css({cursor:q+"-resize",position:"absolute",zIndex:n}).addClass("ord-"+q);ha.support&&
n.bind("touchstart.jcrop",ha.createDragger(q));qa.append(n);return n}function w(q){var n;for(n=0;n<q.length;n++)d(q[n],R++).addClass("jcrop-dragbar")}function u(q){var n;for(n=0;n<q.length;n++){switch(q[n]){case "n":var W="hline";break;case "s":W="hline bottom";break;case "e":W="vline right";break;case "w":W="vline"}var ka=W;ka=f("<div />").css({position:"absolute",opacity:b.borderOpacity}).addClass(b.baseClass+"-"+ka);ya.append(ka)}}function B(q){var n;for(n=0;n<q.length;n++){var W=b.handleSize,
ka=d(q[n],R++).css({opacity:b.handleOpacity}).addClass(b.baseClass+"-handle");W&&ka.width(W).height(W)}}function m(){var q=L.getFixed();L.setPressed([q.x,q.y]);L.setCurrent([q.x2,q.y2]);p()}function p(q){if(x)return y(q)}function y(q){var n=L.getFixed(),W=n.h;ra.width(Math.round(n.w)).height(Math.round(W));W=n.x;var ka=n.y;b.shade||ma.css({top:F(-ka),left:F(-W)});ra.css({top:F(ka),left:F(W)});b.shade&&la.updateRaw(n);x||(ra.show(),b.shade?la.opacity(ta):v(ta,!0),x=!0);q?b.onSelect.call(fa,ca(n)):
b.onChange.call(fa,ca(n))}function v(q,n,W){if(x||n)b.bgFade&&!W?J.animate({opacity:q},{queue:!1,duration:b.fadeTime}):J.css("opacity",q)}function Z(){P=!0;if(b.allowResize)return qa.show(),!0}function X(){P=!1;qa.hide()}function g(q){q?(Ba=!0,X()):(Ba=!1,Z())}var x,R=370,P=!1;b.dragEdges&&f.isArray(b.createDragbars)&&w(b.createDragbars);f.isArray(b.createHandles)&&B(b.createHandles);b.drawBorders&&f.isArray(b.createBorders)&&u(b.createBorders);f(document).bind("touchstart.jcrop-ios",function(q){f(q.currentTarget).hasClass("jcrop-tracker")&&
q.stopPropagation()});var da=h().mousedown(Q("move")).css({cursor:"move",position:"absolute",zIndex:360});ha.support&&da.bind("touchstart.jcrop",ha.createDragger("move"));ya.append(da);X();return{updateVisible:p,update:y,release:function(){X();ra.hide();b.shade?la.opacity(1):v(1);x=!1;b.onRelease.call(fa)},refresh:m,isAwake:function(){return x},setCursor:function(q){da.css("cursor",q)},enableHandles:Z,enableOnly:function(){P=!0},showHandles:function(){P&&qa.show()},disableHandles:X,animMode:g,setBgOpacity:v,
done:function(){g(!1);m()}}}(),ia=function(){function d(v){m(c(v));return!1}function w(v){v.preventDefault();v.stopPropagation();pa&&(pa=!1,p(c(v)),D.isAwake()&&b.onSelect.call(fa,ca(L.getFixed())),na.css({zIndex:290}),f(document).unbind(".jcrop"),m=function(){},p=function(){});return!1}function u(v){m(c(ha.cfilter(v)));return!1}function B(v){return w(ha.cfilter(v))}var m=function(){},p=function(){},y=b.trackDocument;y||na.mousemove(d).mouseup(w).mouseout(w);J.before(na);return{activateHandlers:function(v,
Z,X){pa=!0;m=v;p=Z;na.css({zIndex:450});X?f(document).bind("touchmove.jcrop",u).bind("touchend.jcrop",B):y&&f(document).bind("mousemove.jcrop",d).bind("mouseup.jcrop",w);return!1},setCursor:function(v){na.css("cursor",v)}}}(),za=function(){function d(p){B.hide()}function w(p,y,v){b.allowMove&&(L.moveOffset([y,v]),D.updateVisible(!0));p.preventDefault();p.stopPropagation()}function u(p){if(p.ctrlKey||p.metaKey)return!0;var y=(Ea=p.shiftKey?!0:!1)?10:1;switch(p.keyCode){case 37:w(p,-y,0);break;case 39:w(p,
y,0);break;case 38:w(p,0,-y);break;case 40:w(p,0,y);break;case 27:b.allowSelect&&D.release();break;case 9:return!0}return!1}var B=f('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),m=f("<div />").css({position:"absolute",overflow:"hidden"}).append(B);b.keySupport&&(B.keydown(u).blur(d),Da||!b.fixedSupport?(B.css({position:"absolute",left:"-20px"}),m.append(B).insertBefore(J)):B.insertBefore(J));return{watchKeys:function(){b.keySupport&&(B.show(),
B.focus())}}}();ha.support&&na.bind("touchstart.jcrop",ha.newSelection);qa.hide();G(!0);var fa={setImage:function(d,w){D.release();I();var u=new Image;u.onload=function(){var B=u.height,m=b.boxWidth,p=b.boxHeight;J.width(u.width).height(B);J.attr("src",d);ma.attr("src",d);N(J,m,p);M=J.width();H=J.height();ma.width(M).height(H);na.width(M+2*sa).height(H+2*sa);ja.width(M).height(H);la.resize(M,H);O();"function"===typeof w&&w.call(fa)};u.src=d},animateTo:function(d,w){var u=d[0]/Y,B=d[1]/ba,m=d[2]/Y,
p=d[3]/ba;if(!Ba){d=L.flipCoords(u,B,m,p);var y=L.getFixed(),v=[y.x,y.y,y.x2,y.y2],Z=b.animationDelay,X=d[0]-v[0],g=d[1]-v[1],x=d[2]-v[2],R=d[3]-v[3],P=0,da=b.swingSpeed;u=v[0];B=v[1];m=v[2];p=v[3];D.animMode(!0);var q=function(){return function(){P+=(100-P)/da;v[0]=Math.round(u+P/100*X);v[1]=Math.round(B+P/100*g);v[2]=Math.round(m+P/100*x);v[3]=Math.round(p+P/100*R);99.8<=P&&(P=100);100>P?(E(v),window.setTimeout(q,Z)):(D.done(),D.animMode(!1),"function"===typeof w&&w.call(fa))}}();window.setTimeout(q,
Z)}},setSelect:C,setOptions:function(d){t(d);G()},tellSelect:function(){return ca(L.getFixed())},tellScaled:function(){return L.getFixed()},setClass:function(d){ja.removeClass().addClass(b.baseClass+"-holder").addClass(d)},disable:I,enable:O,cancel:function(){D.done();ia.activateHandlers(null,null)},release:D.release,destroy:function(){ja.remove();V.show();V.css("visibility","visible");f(S).removeData("Jcrop")},focus:za.watchKeys,getBounds:function(){return[M*Y,H*ba]},getWidgetSize:function(){return[M,
H]},getScaleFactor:function(){return[Y,ba]},getOptions:function(){return b},ui:{holder:ja,selection:ra}};ea&&ja.bind("selectstart",function(){return!1});V.data("Jcrop",fa);return fa};f.fn.Jcrop=function(S,K){var F;this.each(function(){if(f(this).data("Jcrop")){if("api"===S)return f(this).data("Jcrop");f(this).data("Jcrop").setOptions(S)}else"IMG"==this.tagName?f.Jcrop.Loader(this,function(){f(this).css({display:"block",visibility:"hidden"});F=f.Jcrop(this,S);f.isFunction(K)&&K.call(F)}):(f(this).css({display:"block",
visibility:"hidden"}),F=f.Jcrop(this,S),f.isFunction(K)&&K.call(F))});return this};f.Jcrop.Loader=function(S,K,F){function e(){t.complete?(c.unbind(".jcloader"),f.isFunction(K)&&K.call(t)):window.setTimeout(e,50)}var c=f(S),t=c[0];c.bind("load.jcloader",e).bind("error.jcloader",function(l){c.unbind(".jcloader");f.isFunction(F)&&F.call(t)});t.complete&&f.isFunction(K)&&(c.unbind(".jcloader"),K.call(t))};f.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",
addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:"n s e w nw ne se sw".split(" "),createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},
onRelease:function(){}}})(jQuery);
(function(f,S){var K=0;const F="png PNG jpg JPG jpeg JPEG".split(" ");f.widget("s3.imageUpload",{options:{videoDialogTitle:"Capture Image",shutterButtonLabel:"OK"},_create:function(){this.id=K;K+=1;this.eventNamespace=".imageUpload"},_init:function(){var e=f(this.element);const c=e.attr("id");e=e.closest("div.image-input");this.canvas=f(".image-input-canvas",e);this.canvasSize=[0,0];this.toScale=!0;this.uploadTitle=f(".upload-title",e);this.uploadContainer=f(".upload-container",e);this.uploadedImage=
f(".uploaded-image",e);this.dropArea=f(".imagecrop-drag",e);this.captureButton=f(".capture-btn",e);this.videoDialog=null;this.imageData=f("input#"+c+"-imagecrop-data",e);this.selectCrop=f(".select-crop-btn",e);this.crop=f(".crop-btn",e);this.cancel=f(".remove-btn",e);this.cropPoints=this.jCropAPI=this.extension=this.fileName=this.image=null;this.refresh()},_destroy:function(){this._removeCropAPI();this._removeVideoDialog()},refresh:function(){this._unbindEvents();this.image=new Image;this.fileName=
"upload.png";this.extension="png";this._removeCropAPI();this._removeVideoDialog();f(this.element).closest("div.image-input");const e=this.canvas,c=this;if(e.length){var t=e.width(),l=e.height();this.toScale=!0;if(0==t||0==l)this.toScale=!1,t=l=600;this.canvasSize=[t,l];var A=this.image,aa=this.imageData,T=aa.data("url");T&&(A.src=T,A.onload=function(){e.attr({width:A.width,height:A.height});e[0].getContext("2d").drawImage(A,0,0,A.width,A.height);var Q=T.split(".");Q=Q[Q.length-1];"jpg"==Q&&(Q="jpeg");
c.extension=Q;let N=aa.data("filename");c.fileName=N?N:"upload_"+(new Date).valueOf()+"."+Q;Q=e[0].toDataURL("image/"+Q,.99);c._loadImage(Q)});this._bindEvents()}},_calculateScale:function(e,c){let t;c[0]>e[0]&&(t=e[0]/c[0],c[0]*=t,c[1]*=t);c[1]>e[1]&&(t=e[1]/c[1],c[0]*=t,c[1]*=t);c[0]=Math.floor(c[0]);c[1]=Math.floor(c[1]);return c},_loadImage:function(e){const c=this,t=this.image;t.src=e;t.onload=function(){var l=c._calculateScale(c.canvasSize,[t.width,t.height]);let A=c.canvas[0];A.width=l[0];
A.height=l[1];A.getContext("2d").drawImage(t,0,0,l[0],l[1]);l=A.toDataURL("image/"+c.extension,.99);c.toScale?c.imageData.val(c.fileName+";"+l):c.imageData.val(c.fileName+";"+e);c.uploadedImage.attr({src:l,style:"display: block"});c.selectCrop.css({display:"inline"}).siblings("hr").show()}},_initCropAPI:function(){const e=this;this._removeCropAPI();this.uploadedImage.Jcrop({onChange:function(c){e.cropPoints=[c.x,c.y,c.x2,c.y2]},opacity:.2,bgFade:!0,bgColor:"black",addClass:"jcrop-light"},function(){e.jCropAPI=
this;this.ui.selection.addClass("jcrop-selection");this.disable()})},_removeCropAPI:function(){const e=this.jCropAPI;e&&(e.destroy(),this.jCropAPI=null);this.cropPoints=null},_activateCrop:function(){const e=this.jCropAPI;if(e){e.enable();var c=e.getBounds(),t=c[0]/7,l=c[1]/7;e.animateTo([t,l,c[0]-t,c[1]-l]);this.selectCrop.css({display:"none"});this.crop.css({display:"inline"});this.cancel.css({display:"inline"})}},_deactivateCrop:function(){const e=this.jCropAPI;e&&(e.release(),e.disable());this.selectCrop.css({display:"inline"});
this.crop.css({display:"none"});this.cancel.css({display:"none"})},_cropImage:function(){var e=this.image,c=f(".jcrop-holder",f(this.element).closest("div.image-input")),t=parseInt(c.css("width").split("px")[0]),l=parseInt(c.css("height").split("px")[0]);c=e.width/t;l=e.height/l;if(t=this.cropPoints){var A=t[0],aa=t[1],T=t[3];t=Math.round((t[2]-A)*c);l=Math.round((T-aa)*l);this._deactivateCrop();this._removeCropAPI();T=this.canvas;var Q=T[0];T.attr({width:t,height:l});Q.getContext("2d").drawImage(e,
Math.round(A*c),Math.round(aa*c),t,l,0,0,t,l);e=Q.toDataURL("image/"+this.extension,.99);this._loadImage(e)}},_isValidImage:function(e){e=e.type.split("/");var c=e[e.length-1];if("image"==e[0]&&-1!=f.inArray(c,F))return"png"==c||"PNG"==c?"png":"jpeg"},_indicateFileOver:function(e){e.stopPropagation();e.preventDefault();let c=f(e.target);"dragenter"==e.type?c.addClass("hover"):c.removeClass("hover")},_loadSelectedFile:function(e){const c=f(this.element),t=this;this._removeCropAPI();this._indicateFileOver(e);
this._hideUpload(!0);e=(e.target.files||e.originalEvent.dataTransfer.files)[0];var l=this._isValidImage(e);l?(this.fileName=e.name,this.extension=l,l=new FileReader,l.onload=function(A){t._loadImage(A.target.result)},l.readAsDataURL(e)):alert(i18n.invalid_image+"\n"+i18n.supported_image_formats+": png, jpeg or jpg");c.val("")},_openVideoDialog:function(){const e=this.options,c=this,t=this.eventNamespace;var l=f('<div class="capture-form">').css({overflow:"hidden","max-width":"100%"}),A=f("<video>").css({width:"800px",
"max-width":"100%",display:"block","margin-left":"auto","margin-right":"auto"}).appendTo(l),aa=f('<button type="button">'+e.shutterButtonLabel+"</button>");this.videoForm=l;aa.addClass("primary button action-btn").css({display:"block",width:"100%"}).appendTo(l);var T=this.captureButton.hide(),Q=f('<div class="inline-throbber">').insertAfter(T);l.dialog({title:e.videoDialogTitle,width:800,autoOpen:!1,modal:!0,classes:{"ui-dialog":"capture-dialog"},close:function(){}});navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:"environment"},
width:{ideal:1280},height:{ideal:1280}},audio:!1}).then(N=>{Q.remove();T.show();A.show();l.dialog("open");let ca=A.get(0);ca.srcObject=N;ca.play();A.add(aa).off(t).on("click"+t,function(a){a.stopPropagation();a.preventDefault();c._captureImage(ca,N);c._removeVideoDialog()})}).catch(N=>{alert(`An error occurred: ${N}`);Q.remove();c.captureButton.prop("disabled",!0).hide();c._removeVideoDialog()})},_captureImage:function(e,c){const t=this;var l=!1;if("ImageCapture"in window)try{const aa=c.getVideoTracks()[0];
(new ImageCapture(aa)).takePhoto().then(function(T){A=URL.createObjectURL(T);t._hideUpload(!0);A&&(t.fileName="capture_"+(new Date).valueOf()+".png",t.extension="png",t._loadImage(A))});l=True}catch(aa){}if(!l){c=document.createElement("canvas");c.width=e.videoWidth;c.height=e.videoHeight;c.getContext("2d").drawImage(e,0,0,c.width,c.height);var A=c.toDataURL("image/png",.99);c.remove();t._hideUpload(!0);A&&(t.fileName="capture_"+(new Date).valueOf()+".png",t.extension="png",t._loadImage(A))}},_removeVideoDialog:function(){var e=
this.videoForm;e&&(e.dialog("close").dialog("destroy").remove(),this.videoForm=null)},_hideUpload:function(e){const c=this;var t=e?i18n.upload_new_image:i18n.upload_image;setTimeout(function(){c.uploadContainer.slideUp("fast",function(){c.uploadTitle.html("<a>"+t+"</a>")})},500)},_bindEvents:function(){let e=f(this.element),c=this.eventNamespace,t=this;e.on("change"+c,function(l){t._loadSelectedFile(l)});this.uploadTitle.on("click"+c,function(l){t.uploadContainer.slideDown("fast",function(){t.uploadTitle.html(i18n.upload_image)})});
this.selectCrop.on("click"+c,function(){t._activateCrop()});this.crop.on("click"+c,function(){t._cropImage()});this.cancel.on("click"+c,function(){t._deactivateCrop()});this.uploadedImage.on("load"+c,function(){t._initCropAPI()});this.dropArea.on("dragenter"+c,function(l){l.stopPropagation();l.preventDefault();t._indicateFileOver(l)}).on("dragover"+c,function(l){l.stopPropagation();l.preventDefault()}).on("dragleave"+c,function(l){t._indicateFileOver(l)}).on("drop"+c,function(l){l.stopPropagation();
l.preventDefault();t._loadSelectedFile(l)});this.captureButton.on("click"+c,function(){t._openVideoDialog()});return this},_unbindEvents:function(){let e=f(this.element),c=this.eventNamespace;e.off(c);this.uploadTitle.off(c);this.selectCrop.off(c);this.crop.off(c);this.cancel.off(c);this.uploadedImage.off(c);this.dropArea.off(c);this.captureButton.off(c);return this}})})(jQuery);$(function(){});
